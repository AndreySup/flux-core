flux_rpc_multi(3)
=================
:doctype: manpage


NAME
----
flux_rpc_multi, flux_rpc_completed, - send a remote procedure call to a Flux service on multiple ranks


SYNOPSIS
--------
#include <flux/core.h>

flux_rpc_t *flux_rpc_multi (flux_t h, const char *topic, const char *json_str,
                            const char *nodeset, int flags);

bool flux_rpc_completed (flux_rpc_t *rpc);

DESCRIPTION
-----------

`flux_rpc_multi()` sends requests to a Flux service identified by _topic_
via Flux broker handle _h_.   The _nodeset_ represents a set of ranks
that will receive the request, and is specified in bracketed range format,
e.g. "[0-255]", "[1,3,5-10]", or "all" for all ranks in the session.

If _json_str_ is non-NULL, it should represent a valid JSON string
that will be attached as request payload.

Flags may be zero or a mask of the following values:

FLUX_RPC_NORESPONSE::
No response will be expected to the request, and the request will not be
assigned a matchtag.

`flux_rpc_get(3)` may be used, as with `flux_rpc(3)`, to process responses.
Each call to `flux_rpc_get(3)` invalidates any payload obtained via a
previous call.

`flux_rpc_check(3)` may be used, as with `flux_rpc(3)`, to determine
whether `flux_rpc_get(3)` will block.

`flux_rpc_completed()` returns true once all the RPC responses have been
received and handled via `flux_rpc_get()`.  It can be used to terminate
synchronous response collection, e.g.
....
while (!flux_rpc_completed (rpc))
    flux_rpc_get (rpc, &nodeid, &payload);
....

`flux_rpc_then(3)` may be used, as with `flux_rpc(3)`, to register a
reactor callback to handle each RPC responses message.

`flux_rpc_destroy(3)` should be used to dispose of the flux_rpc_t object
once the RPC has completed.  After this function is called, any payload
returned by `flux_rpc_get()` is invalidated.


RETURN VALUE
------------

`flux_rpc_multi()` returns a flux_rpc_t object on success.  On error, NULL
is returned, and errno is set appropriately.

`flux_rpc_completed()` returns true if the RPC has completed, else false.
It does not report any errors.


ERRORS
------

ENOSYS::
Handle has no send operation.

EINVAL::
Some arguments were invalid.

EPROTO::
A protocol error was encountered.


EXAMPLE
-------

This example performs an RPC with the broker's "cmb.info" service on all
ranks.  A continuation is registered to process the responses as they arrive.
The reactor loop terminates once the RPC is completed since the completion
is its only event handler.

....
include::trpc_then_multi.c[]
....


AUTHOR
------
This page is maintained by the Flux community.


RESOURCES
---------
Github: <http://github.com/flux-framework>


COPYRIGHT
---------
include::COPYRIGHT.adoc[]


SEE ALSO
---------
flux_rpc(3), flux_rpc_then(3)

https://github.com/flux-framework/rfc/blob/master/spec_6.adoc[RFC 6: Flux
Remote Procedure Call Protocol]
